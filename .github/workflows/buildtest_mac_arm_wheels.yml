name: Build and Test Apple Silicon wheels

on: workflow_dispatch

jobs:
  build_wheels:
    runs-on: [self-hosted, macOS, ARM64]
      steps:
        - name: Checkout
          uses: actions/checkout@v3
        
        - name: Setup Python
          uses: actions/setup-python@v4
          with:
            python-version: "3.10"
        
        - name: Install cibuildwheel
          run: python -m pip install cibuildwheel==2.15.0
    
        - name: Build wheels
          run: python -m nox --sessions build_wheel test_wheel

        - name: Test wheels
          run: python -m nox --sessions test_wheel
            
        - uses: actions/upload-artifact@v3
          with:
            path: ./wheelhouse/*.whl